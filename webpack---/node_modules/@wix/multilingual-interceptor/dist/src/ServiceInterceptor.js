"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getUrlParameterFromUrl = exports.multilingualGQLInterceptor = void 0;
var base64 = require("base-64");
// Apollo client 1.x
function multilingualGQLInterceptor(_a) {
    var param = _a.param, instance = _a.instance, locale = _a.locale, isPrimary = _a.isPrimary;
    return {
        applyMiddleware: function (req, next) {
            if (!req.options.headers) {
                req.options.headers = {};
            }
            var decodedInstance;
            var encodedInstance;
            if (instance && typeof instance === 'string') {
                encodedInstance = instance.split('.')[1];
            }
            try {
                decodedInstance = encodedInstance && JSON.parse(base64.decode(encodedInstance));
            }
            catch (e) {
                decodedInstance = undefined;
            }
            if (param && decodedInstance && decodedInstance.instanceId && locale && isPrimary) {
                req.options.headers['x-wix-linguist'] = param + "|" + locale + "|" + isPrimary + "|" + decodedInstance.instanceId;
            }
            next();
        }
    };
}
exports.multilingualGQLInterceptor = multilingualGQLInterceptor;
function getUrlParameterFromUrl(name, url) {
    name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
    var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
    var results = regex.exec(url);
    return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
}
exports.getUrlParameterFromUrl = getUrlParameterFromUrl;
//# sourceMappingURL=ServiceInterceptor.js.map